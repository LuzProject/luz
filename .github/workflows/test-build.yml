name: Build test package

env:
  zip-link: https://cdn.discordapp.com/attachments/820399697125965844/1067555101704736788/tweak.zip

on:
  release:
    types: [published]

  workflow_dispatch:
      
  push:
    paths-ignore:
      - '**.md'

jobs:
  build:
    name: Build
    runs-on: macos-12

    steps:
      - name: Checkout Project
        uses: actions/checkout@v3
      
      - name: Checkout Logos
        uses: actions/checkout@v3
        with:
          repository: LuzProject/logos
          path: /Users/runner/.luz/logos
          submodules: 'recursive'
      
      - name: Checkout Libraries
        uses: actions/checkout@v3
        with:
          repository: elihwyma/lib
          path: /Users/runner/.luz/lib
          ref: rootless
          submodules: 'recursive'
      
      - name: Checkout Headers
        uses: actions/checkout@v3
        with:
          repository: theos/headers
          path: /Users/runner/.luz/include
          submodules: 'recursive'
        
      - name: Select Xcode version (14.2)
        run: |
          sudo xcode-select --switch /Applications/Xcode_14.2.app
          
      - name: Install ldid
        run: |
          brew install ldid
          
      - name: Set up Python
        id: setup-python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Build and install project
        run: pip install . && echo $HOME
        
      - name: Get tweak zip
        run: |
            wget ${{ env.zip-link }}
            unzip tweak.zip
    
      - name: Build tweak
        run: cd tweak && luz build
